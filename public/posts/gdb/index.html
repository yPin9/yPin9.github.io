<!DOCTYPE html>
<html lang="en" data-theme="light">
<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>GDB | yiπng</title>

<link rel="stylesheet" href="http://localhost:1313//css/styles.css">
<link rel="stylesheet" href="http://localhost:1313//css/custom.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" 
integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>


<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" />
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-minima.css" />
<script type="text/javascript" src="http://localhost:1313//js/jssocials.js"></script>


<div class="container">
    <nav class="navbar level">
      <div class="navbar-brand">
          <a class="nav-item" href="http://localhost:1313/"><h1 class="title is-3">yiπng</h1></a>
      </div>           
      <div class="navbar-menu has-text-centered is-active">
          <div class="navbar-end is-centered">
              
                <a href="http://localhost:1313/about" rel="me">
                  <span class="icon">
                    <i class="fas fa-info"></i>
                  </span>
                </a>
              
                <a href="https://github.com/yPin9" rel="me">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                </a>
              
                <a href="https://x.com/ypp_tw" rel="me">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              
           </div>
      </div>
    </nav>
  </div>

<div class="container">
  <h2 class="subtitle is-6">September 21, 2024</h2>
  <h1 class="subtitle is-size-4-mobile is-size-3-desktop">GDB</h1>
  <div class="content">
    <h2 id="learn-how-to-debug-binary">Learn How To Debug Binary</h2>
<p>Demo source code</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">welcome</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;welcome!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span> (<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">increase_int</span>(<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> a ){
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>a)<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> c <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;welcome to main function</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">welcome</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;a is %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#f92672">*</span>b);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;after increase_int</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">increase_int</span>(b);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;a is %d&#34;</span>,<span style="color:#f92672">*</span>b);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="let-start-use-gdb-to-debug">Let start use GDB to debug</h2>
<blockquote>
<p><code>gdb ./filename</code></p>
</blockquote>
<blockquote>
<p>我有裝 plug-in，所以21行一般顯示 gdb，而我是顯示 gef</p>
</blockquote>
<p><a href="https://github.com/hugsy/gef">這邊安裝 gef</a></p>
<pre tabindex="0"><code class="language-shell=[]=" data-lang="shell=[]=">&gt; gdb ./a.out 
GNU gdb (Ubuntu 12.1-0ubuntu1~22.04.2) 12.1
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type &#34;show copying&#34; and &#34;show warranty&#34; for details.
This GDB was configured as &#34;x86_64-linux-gnu&#34;.
Type &#34;show configuration&#34; for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type &#34;help&#34;.
Type &#34;apropos word&#34; to search for commands related to &#34;word&#34;...
GEF for linux ready, type `gef&#39; to start, `gef config&#39; to configure
93 commands loaded and 5 functions added for GDB 12.1 in 0.01ms using Python engine 3.10
Reading symbols from ./a.out...
(No debugging symbols found in ./a.out)
gef➤ 
</code></pre><h2 id="run">Run</h2>
<p>執行檔案</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gef➤  run
</span></span><span style="display:flex;"><span>Starting program: /home/ypp/Downloads/gdb_tutorial/a.out 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Thread debugging using libthread_db enabled<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Using host libthread_db library <span style="color:#e6db74">&#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;</span>.
</span></span><span style="display:flex;"><span>welcome to main <span style="color:#66d9ef">function</span>
</span></span><span style="display:flex;"><span>welcome!
</span></span><span style="display:flex;"><span>a is <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>after increase_int
</span></span><span style="display:flex;"><span>a is 1<span style="color:#f92672">[</span>Inferior <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>process 3656<span style="color:#f92672">)</span> exited normally<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>gef➤  
</span></span></code></pre></div><h2 id="breakpoint">Breakpoint</h2>
<p>breakpoint，顧名思義就是在程式執行時下斷點，讓程式停在在某個指令(instruction)，好讓我們可以更方便的分析程式行為</p>
<ul>
<li>
<p>如果使用 <code>gcc -g</code> 編譯(生成)，則可以使用 <code>b [number]</code> 在第 <code>number</code> 行進行斷點。</p>
</li>
<li>
<p>如果該執行檔被 strip()，則可以先去靜態分析找到 <code>main</code> 的地址 然後使用 <code>b *[address]</code> 對該地址下斷點</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gef➤  b main
</span></span><span style="display:flex;"><span>Breakpoint <span style="color:#ae81ff">1</span> at 0x5555555551e5
</span></span><span style="display:flex;"><span>gef➤  b *0x555555555223
</span></span><span style="display:flex;"><span>Breakpoint <span style="color:#ae81ff">7</span> at 0x555555555223  
</span></span></code></pre></div><p>列出目前的 breakpoint</p>
<pre tabindex="0"><code class="language-shell=[]=" data-lang="shell=[]=">gef➤  i b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x00005555555551e5 &lt;main+8&gt;
gef➤  
</code></pre><ul>
<li><code>i b</code> → info breakpoint</li>
<li><code>d [breaknumber]</code> → delete breakpoint</li>
</ul>
<blockquote>
<p>刪除 breakpoint，注意這邊是使用 breakpoint number</p>
</blockquote>
<pre tabindex="0"><code class="language-shell=[]=" data-lang="shell=[]=">gef➤  i b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x00005555555551e5 &lt;main+8&gt;
gef➤  d 1
gef➤  i b
No breakpoints or watchpoints.
</code></pre><h2 id="ni--si">ni &amp; si</h2>
<ul>
<li>
<p>ni means <strong>next</strong> instruction</p>
</li>
<li>
<p>si means <strong>step in</strong> instrction</p>
</li>
</ul>
<h3 id="differen-with-ni-and--si">Differen with <code>ni</code> and  <code>si</code></h3>
<blockquote>
<p>ni 是執行下一個指令，不步入 <code>function</code>，而 si 也是執行下一個指令，但他會步入 <code>function</code></p>
</blockquote>
<blockquote>
<p>以下(表/圖?)為例，我們的 <code>$rip</code>，指在 <code>0x555555555228</code>，的位置</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">      0x555555555223 &lt;main+0046&gt;      mov    eax, 0x0
rip → 0x555555555228 &lt;main+004b&gt;      call   0x555555555189 &lt;welcome&gt;
      0x55555555522d &lt;main+0050&gt;      mov    rax, QWORD PTR [rbp-0x10]
      0x555555555231 &lt;main+0054&gt;      mov    eax, DWORD PTR [rax]
      0x555555555233 &lt;main+0056&gt;      mov    esi, eax
      0x555555555235 &lt;main+0058&gt;      lea    rax, [rip+0xdea] 
</code></pre><blockquote>
<p>使用 <code>ni</code> 後 <code>$rip</code> 會指在 <code>0x55555555522d</code></p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">      0x555555555223 &lt;main+0046&gt;      mov    eax, 0x0
rip → 0x555555555228 &lt;main+004b&gt;      call   0x555555555189 &lt;welcome&gt;
      0x55555555522d &lt;main+0050&gt;      mov    rax, QWORD PTR [rbp-0x10]
      0x555555555231 &lt;main+0054&gt;      mov    eax, DWORD PTR [rax]
      0x555555555233 &lt;main+0056&gt;      mov    esi, eax
      0x555555555235 &lt;main+0058&gt;      lea    rax, [rip+0xdea] 
</code></pre><pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  ni
</code></pre><pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">      0x555555555223 &lt;main+0046&gt;      mov    eax, 0x0
      0x555555555228 &lt;main+004b&gt;      call   0x555555555189 &lt;welcome&gt;
rip → 0x55555555522d &lt;main+0050&gt;      mov    rax, QWORD PTR [rbp-0x10]
      0x555555555231 &lt;main+0054&gt;      mov    eax, DWORD PTR [rax]
      0x555555555233 &lt;main+0056&gt;      mov    esi, eax
      0x555555555235 &lt;main+0058&gt;      lea    rax, [rip+0xdea] 
</code></pre><blockquote>
<p>如果使用 <code>si</code> 後 <code>$rip</code> 會指在 <code>0x555555555189</code>，也就是會指到 <code>welcome</code> 這個 function 的一開始，進入這個 function，慢慢執行這個 function 的每一個指令，這就是步入</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">      0x555555555223 &lt;main+0046&gt;      mov    eax, 0x0
rip→  0x555555555228 &lt;main+004b&gt;      call   0x555555555189 &lt;welcome&gt;
   ↳    0x555555555189 &lt;welcome+0000&gt;   endbr64 
        0x55555555518d &lt;welcome+0004&gt;   push   rbp
        0x55555555518e &lt;welcome+0005&gt;   mov    rbp, rsp
        0x555555555191 &lt;welcome+0008&gt;   lea    rax, [rip+0xe6c]        # 0x555555556004
        0x555555555198 &lt;welcome+000f&gt;   mov    rdi, rax
</code></pre><pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  si
</code></pre><pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">      0x555555555223 &lt;main+0046&gt;      mov    eax, 0x0
      0x555555555228 &lt;main+004b&gt;      call   0x555555555189 &lt;welcome&gt;
      ↳ rip→  0x555555555189 &lt;welcome+0000&gt;   endbr64 
              0x55555555518d &lt;welcome+0004&gt;   push   rbp
              0x55555555518e &lt;welcome+0005&gt;   mov    rbp, rsp
              0x555555555191 &lt;welcome+0008&gt;   lea    rax, [rip+0xe6c]        # 0x555555556004
              0x555555555198 &lt;welcome+000f&gt;   mov    rdi, rax
</code></pre><h2 id="continue">continue</h2>
<blockquote>
<p>繼續執行，跟 run 很像，差別在於 run 是從頭開始執行， continue 是從目前的 <code>$rip</code> 繼續執行</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  c
</code></pre><h2 id="finish">finish</h2>
<blockquote>
<p>Finish current function call</p>
</blockquote>
<blockquote>
<p>舉例來說我在 <code>main()</code> call 了 <code>increase_int()</code>，然後我在 <code>increase_int()</code> 裡面執行到一半，這時候我使用 <code>finish</code>，則 GDB 會把 <code>increase_int()</code> 執行完(就是執行完 <code>increate_int()</code> 的 <code>ret</code>)，這時候 <code>$rip</code> 會指在 <code>main()</code> function call <code>increase_int</code> 的下一行指令</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  finish
</code></pre><h2 id="x">x</h2>
<blockquote>
<p>x 指令是可以查看記憶體 value 的 command</p>
</blockquote>
<p>x [Address expression]
x /[Format] [Address expression]
x /[Length][Format] [Address expression]</p>
<ul>
<li>
<p>format</p>
<ul>
<li>o - octal</li>
<li>x - hexadecimal</li>
<li>d - decimal</li>
<li>u - unsigned decimal</li>
<li>t - binary</li>
<li>f - floating point</li>
<li>a - address</li>
<li>c - char</li>
<li>s - string</li>
<li>i - instruction</li>
</ul>
</li>
<li>
<p>size modifiers</p>
<ul>
<li>b - byte</li>
<li>h - halfword (16-bit value)</li>
<li>w - word (32-bit value)</li>
<li>g - giant word (64-bit value)</li>
</ul>
</li>
</ul>
<blockquote>
<p>查看某個地址的數值</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  x 0x00007fffffffdeb0
0x7fffffffdeb0:	0x00000001
</code></pre><blockquote>
<p>查看某個地址接下來的10個單位位置的數值(單位預設為 4bytes)</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  x/10 0x00007fffffffdeb0
0x7fffffffdeb0:	0x00000001	0x00000000	0xf7c29d90	0x00007fff
0x7fffffffdec0:	0x00000000	0x00000000	0x555551dd	0x00005555
0x7fffffffded0:	0xffffdfb0	0x00000001
</code></pre><blockquote>
<p>查看某個地址接下來的10個單位位置的數值(g 指令了單位為 8bytes)</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  x/10g 0x00007fffffffdeb0
0x7fffffffdeb0:	0x0000000000000001	0x00007ffff7c29d90
0x7fffffffdec0:	0x0000000000000000	0x00005555555551dd
0x7fffffffded0:	0x00000001ffffdfb0	0x00007fffffffdfc8
0x7fffffffdee0:	0x0000000000000000	0x46ab07aab525de82
0x7fffffffdef0:	0x00007fffffffdfc8	0x00005555555551dd
</code></pre><blockquote>
<p>查看某個地址接下來的10個單位位置的數值(g 指令了單位為 8bytes)，並且使用 16 進制</p>
</blockquote>
<pre tabindex="0"><code class="language-sh=[]=" data-lang="sh=[]=">gef➤  x/10xg 0x00007fffffffdeb0
0x7fffffffdeb0:	0x0000000000000001	0x00007ffff7c29d90
0x7fffffffdec0:	0x0000000000000000	0x00005555555551dd
0x7fffffffded0:	0x00000001ffffdfb0	0x00007fffffffdfc8
0x7fffffffdee0:	0x0000000000000000	0x46ab07aab525de82
0x7fffffffdef0:	0x00007fffffffdfc8	0x00005555555551dd
</code></pre><blockquote>
<p>x/10i [address] 可以看10個 instruction</p>
</blockquote>
<h2 id="dump">dump</h2>
<blockquote>
<p>把 0x0000555555555000 ~ 0x0000555555557000 的 memory contant 拉下來放進 dump.dmp，然後使用 ida 開 (目前不確定副檔名有沒有差)</p>
</blockquote>
<pre tabindex="0"><code class="language-shell=[]=" data-lang="shell=[]=">dump memory dump.dmp 0x0000555555555000 0x0000555555557000
</code></pre><h2 id="backtrace">backtrace</h2>
<blockquote>
<p>查看 call stack，Trace Function Call</p>
</blockquote>
<pre tabindex="0"><code class="language-shell=[]=" data-lang="shell=[]=">gef➤  backtrace
#0  0x00005555555551bb in increase_int ()
#1  0x0000555555555264 in main ()
gef➤  
</code></pre><h2 id="attach">attach</h2>
<blockquote>
<p>在 ctf 時如果想要 attach 上自己的 exploit，去觀察 <code>$register</code>, <code>stack</code> 之類的資訊，可以使用 gdb -p &lt;exploit_pid&gt;</p>
</blockquote>
<h2 id="ctrl--c">Ctrl + C</h2>
<p>就是 interrupt。</p>
<blockquote>
<p>可以在執行時使用，他會 interrupt 住整個 process，方便觀察目前 process 的狀態，再使用前面提到的 contiune 就可以讓 process 繼續執行</p>
</blockquote>
<h2 id="handle-signal">handle signal</h2>
<pre tabindex="0"><code class="language-c=" data-lang="c=">handle SIGINT stop print pass
</code></pre><p>當程序接收到 SIGINT 信號時，GDB 會：</p>
<ul>
<li>暫停程序（stop）</li>
<li>打印收到信號的消息（print）</li>
<li>將信號傳遞給程序（pass）</li>
</ul>
<h2 id="reference">Reference</h2>
<p><a href="https://www.youtube.com/watch?v=svG6OPyKsrw"><u>GDB Tutorial</u>
</a>
這部教學影片是基於 <code>gcc -g</code> 去編譯的可執行檔，所以有更多功能可以使用，我這邊沒有使用，所以缺少符號表、行號之類的東西，所以有些 feature 不能使用</p>

  </div>
</div>
<div class="container has-text-centered">
  
</div>

<section class="section py-0">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>

